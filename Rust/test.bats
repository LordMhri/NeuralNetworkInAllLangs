setup() {
    cargo build --release
}

@test "xor" {
    run ./target/release/neural
    printf 'Lines:\n'
    printf 'lines %s\n' "${lines[@]}" >&2
    printf 'output %s\n' "${output[@]}" >&2
    [ "${lines[0]}" = "Result after 4000 iterations" ]
    [ "${lines[1]}" = "        XOR   XNOR    OR   AND   NOR   NAND" ]
    [ "${lines[2]}" = "0,0 = 0.038  0.962 0.038 0.001 0.963  0.999" ]
    [ "${lines[3]}" = "0,1 = 0.961  0.039 0.970 0.026 0.029  0.974" ]
    [ "${lines[4]}" = "1,0 = 0.961  0.039 0.970 0.026 0.030  0.974" ]
    [ "${lines[5]}" = "1,1 = 0.049  0.952 0.994 0.956 0.006  0.044" ]
    [ "${lines[6]}" = "network: Network {" ]
    [ "${lines[7]}" = "    weights_hidden: [" ]
    [[ "${lines[8]}" =~ -5.94253266329493 ]]
    [[ "${lines[9]}" =~ -7.053489763483629 ]]
    [[ "${lines[10]}" =~ -5.93849179349689 ]]
    [[ "${lines[11]}" =~ -7.080670057743411 ]]
    [ "${lines[13]}" = "    biases_hidden: [" ]
    [[ "${lines[14]}" =~ 8.66080005088484 ]]
    [[ "${lines[15]}" =~ 3.18102806812189 ]]
    [ "${lines[17]}" = "    weights_output: [" ]
    [[ "${lines[18]}" =~ 7.02847492235002 ]]
    [[ "${lines[19]}" =~ -7.0385257683402696 ]]
    [[ "${lines[20]}" =~ -1.730833624456504 ]]
    [[ "${lines[21]}" =~ -7.40327103830852 ]]
    [[ "${lines[22]}" =~ 1.55892562488877 ]]
    [[ "${lines[23]}" =~ 7.390186687736159 ]]
    [[ "${lines[24]}" =~ -7.31042627730994 ]]
    [[ "${lines[25]}" =~ 7.32111860535136 ]]
    [[ "${lines[26]}" =~ -7.03879901708655 ]]
    [[ "${lines[27]}" =~ -2.80022046282448 ]]
    [[ "${lines[28]}" =~ 7.071517018377268 ]]
    [[ "${lines[29]}" =~ 3.21919221700788 ]]
    [ "${lines[31]}" = "    biases_output: [" ]
    [[ "${lines[32]}" =~ -3.245795100480243 ]]
    [[ "${lines[33]}" =~ 3.250424023612059 ]]
    [[ "${lines[34]}" =~ 5.2467380115760 ]]
    [[ "${lines[35]}" =~ 3.36378125079356 ]]
    [[ "${lines[36]}" =~ -5.097046597754945 ]]
    [[ "${lines[37]}" =~ -3.361940360109141 ]]
    [ "${lines[39]}" = "    n_inputs: 2," ]
    [ "${lines[40]}" = "    n_hidden: 2," ]
    [ "${lines[41]}" = "    n_outputs: 6," ]
}
